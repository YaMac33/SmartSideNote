<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmartSideNote</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- 共通ヘッダーを読み込む -->
  <div id="header"></div>
  <script>
    fetch("header.html")
      .then(res => res.text())
      .then(data => {
        document.getElementById("header").innerHTML = data;
      })
      .catch(err => console.error("Header load error:", err));
  </script>

  <main id="project-list-container" class="project-list" aria-live="polite">
    <div class="loader"></div>
  </main>

  <script>
    const username = "YaMac33";
    const repoName = "ai-comparison-test-site";

    document.addEventListener("DOMContentLoaded", function () {
      const container = document.getElementById("project-list-container");
      container.innerHTML = '<div class="loader"></div>';

      fetch(`https://api.github.com/repos/${username}/${repoName}/contents/`)
        .then(response => response.json())
        .then(data => {
          container.innerHTML = "";
          data.reverse();

          data.forEach(item => {
            if (item.type === "dir") {
              const dirName = item.name;
              const card = document.createElement("a");
              card.href = `./${dirName}/`;
              card.className = "project-card";
              card.innerHTML = `<h3>読み込み中...</h3>`;
              container.appendChild(card);

              // ページタイトル取得
              const indexUrl = `https://raw.githubusercontent.com/${username}/${repoName}/main/${dirName}/index.html`;
              fetch(indexUrl)
                .then(res => res.text())
                .then(html => {
                  const match = html.match(/<title>(.*?)<\/title>/i);
                  const title = match ? match[1] : dirName;
                  card.querySelector("h3").textContent = title;
                })
                .catch(() => {
                  card.querySelector("h3").textContent = dirName;
                });
            }
          });
        })
        .catch(error => {
          container.innerHTML = "<p>データの読み込みに失敗しました。</p>";
          console.error("Error fetching repository contents:", error);
        });
    });
  </script>
</body>
</html>
